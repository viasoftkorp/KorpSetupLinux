- hosts: 127.0.0.1
  connection: local
  become: false
  gather_facts: false
  vars_prompt:
    - name: "user_pass"
      prompt: "Senha do usuário administrativo"
      private: true

  tasks:
    - name: definição de senha
      ansible.builtin.set_fact:
        user_pass: "{{ user_pass }}"
      tags:
        - always

- hosts: 127.0.0.1
  connection: local
  become: true
  become_user: root
  vars:
    ansible_become_password: "{{ user_pass }}"

  tasks:
    - name: provisioning
      block:
        - name: provisioning
          ansible.builtin.import_role:
            name: provisioning
          tags:
            - provisioning
            - default-setup

      # bloco só será executado caso ocorra algum erro
      rescue:
        - name: tratativa de erro
          ansible.builtin.import_role:
            name: finishing
            tasks_from: error
          tags:
            - always
            - default-setup

- hosts: 127.0.0.1
  connection: local
  vars:
    ansible_become_password: "{{ linux_korp.password }}"
  become_user: "{{ linux_korp.user }}"
  become: true

  tasks:
    - name: execução de playbook
      block:
        - name: default setup
          ansible.builtin.import_role:
            name: infrastructure
            tasks_from: default_setup
          tags:
            - always
            - default-setup

        - name: infrastructure
          ansible.builtin.import_role:
            name: infrastructure
          tags:
            - infrastructure
            - default-setup

        - name: infrastructure-web
          ansible.builtin.import_role:
            name: infrastructure-web
          tags:
            - infrastructure-web
            - default-setup

        - name: infrastructure-desktop
          ansible.builtin.import_role:
            name: infrastructure-desktop
          tags:
            - infrastructure-desktop
            - default-setup

        - name: FLOW01
          ansible.builtin.import_role:
            name: FLOW01
          tags:
            - FLOW01

        - name: engenharia
          ansible.builtin.import_role:
            name: engenharia
          tags:
            - engenharia

        - name: contabil
          ansible.builtin.import_role:
            name: contabil
          tags:
            - contabil

        - name: ERP
          ansible.builtin.import_role:
            name: ERP
          tags:
            - ERP

        - name: fiscal
          ansible.builtin.import_role:
            name: fiscal
          tags:
            - fiscal

        - name: faturamento
          ansible.builtin.import_role:
            name: faturamento
          tags:
            - faturamento

        - name: logistica
          ansible.builtin.import_role:
            name: logistica
          tags:
            - logistica

        - name: vendas
          ansible.builtin.import_role:
            name: vendas
          tags:
            - vendas

        - name: PCRG001
          ansible.builtin.import_role:
            name: PCRG001
          tags:
            - PCRG001

        - name: PRO09
          ansible.builtin.import_role:
            name: PRO09
          tags:
            - PRO09

        - name: LOG102
          ansible.builtin.import_role:
            name: LOG102
          tags:
            - LOG102

        - name: LOG103
          ansible.builtin.import_role:
            name: LOG103
          tags:
            - LOG103

        - name: MOB02
          ansible.builtin.import_role:
            name: MOB02
          tags:
            - MOB02

        - name: VEN07_W
          ansible.builtin.import_role:
            name: VEN07_W
          tags:
            - VEN07_W

        - name: VEN26
          ansible.builtin.import_role:
            name: VEN26
          tags:
            - VEN26

        - name: compras
          ansible.builtin.import_role:
            name: compras
          tags:
            - compras

        - name: PES00
          ansible.builtin.import_role:
            name: PES00
          tags:
            - PES00

        - name: PES01
          ansible.builtin.import_role:
            name: PES01
          tags:
            - PES01

        - name: LOG00
          ansible.builtin.import_role:
            name: LOG00
          tags:
            - LOG00

        - name: LOG01_W
          ansible.builtin.import_role:
            name: LOG01_W
          tags:
            - LOG01_W

        - name: FAT12
          ansible.builtin.import_role:
            name: FAT12
          tags:
            - FAT12

        - name: CON51_W
          ansible.builtin.import_role:
            name: CON51_W
          tags:
            - CON51_W

        - name: FIN63_W
          ansible.builtin.import_role:
            name: FIN63_W
          tags:
            - FIN63_W

        - name: REL01
          ansible.builtin.import_role:
            name: REL01
          tags:
            - REL01
            - default-setup

        - name: VEN_WEB_01
          ansible.builtin.import_role:
            name: VEN_WEB_01
          tags:
            - VEN_WEB_01

        - name: object-storage
          ansible.builtin.import_role:
            name: object-storage
          tags:
            - never
            - object-storage

        # essa deve ser a ultima task
        - name: finishing
          ansible.builtin.import_role:
            name: finishing
          tags:
            - finishing
            - always

      # bloco só será executado caso ocorra algum erro
      rescue:
        - name: tratativa de erro
          ansible.builtin.import_role:
            name: finishing
            tasks_from: error
          tags:
            - always
