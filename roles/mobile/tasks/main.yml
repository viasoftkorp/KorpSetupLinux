- name: adição de serviços de mobile
  ansible.builtin.include_role:
    name: utils
    tasks_from: services/add_service
  vars:
    service_name: "{{ item }}"
    consul_kv: "{{ lookup('template', 'consul_kv/{{ item | lower }}.json.j2') }}"
  loop:
    - Korp.Mobile
    - Korp.Financial.Situation
    - Korp.Logistica.SaldoProdutos
    - Korp.Sales.PriceControl
    - Viasoft.Customer.Portifolio
    - Korp.Logistic.Tracking

- name: configuração e transferência de arquivos de compose de mobile
  ansible.builtin.template:
    dest: "{{ korp_dir_path }}/composes/{{ item[:-3] | basename }}"
    src: "composes/{{ item | basename }}"
    owner: "{{ linux_korp.user }}"
    group: root
    mode: '0644'
  loop:
    "{{ lookup('fileglob', 'templates/composes/*', wantlist=True) | select('search','.yml.j2') }}"

- name: garantia da existência dos diretórios de volumes de mobile
  ansible.builtin.include_role:
    name: utils
    tasks_from: services/ensure_volume_folder
  vars:
    volume_path: "{{ item }}"
  loop:
    - "{{ dados_docker_dir_path }}/korp-mobile/reports"

- name: criação e inicialização de mobile-compose
  community.docker.docker_compose:
    project_src: "{{ korp_dir_path }}/composes/"
    files:
      - mobile-compose.yml
