- name: Update de apps
  block:

    - name: Definição de lista de serviços
      block: 
      - name: Adição de serviços não versionados à lista
        ansible.builtin.set_fact:
          services_list: "{{ temp_apps_map.unversioned }}"

      - name: Adição de serviços versionados à lista
        ansible.builtin.set_fact:
           services_list: "{{ services_list + item.value }}"
        with_dict: "{{ temp_apps_map.versioned }}"
      when: has_versioned_apps

    - name: Instalação de apps
      ansible.builtin.include_role:
        name: utils
        tasks_from: apps/install.yml
      loop: "{{ (services_list | default(temp_apps_map.unversioned)) | unique }}"
      loop_control:
        loop_var: app_name

  tags: always
